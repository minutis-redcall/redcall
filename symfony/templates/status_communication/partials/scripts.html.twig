<script type="text/javascript">

    {# -------------------------------------------------------------------------------- #}
    {# Auto refresh information
    {# -------------------------------------------------------------------------------- #}

    var types = {
        sms: '{{ 'message.sms.type'|trans }}',
        call: '{{ 'message.call.type'|trans }}',
        email: '{{ 'message.email.type'|trans }}',
    };

    function refreshStatuses(data) {

        {# Update Group Labels #}
        if (data['groupNames']) {
            $.each(data['groupNames'], function (index, name) {
                var label = name || '{{ 'campaign_status.groups.title'|trans|e('js') }} ' + (parseInt(index) + 1);
                $('.group-label-' + index).html(label);
                $('.group-name-input[data-index="' + index + '"]').val(name);
            });
        }

        {# Update Volunteer Group Dots #}
        if (data['volunteerGroups']) {
            $.each(communicationIds, function (k, communicationId) {
                $('.row-' + communicationId).each(function () {
                    var row = $(this);
                    var volunteerId = row.data('volunteer-id');
                    var suffix = communicationId + '-' + row.attr('id').split('-').pop();
                    var container = $('#volunteer-groups-' + suffix);
                    var assignedIndices = data['volunteerGroups'][volunteerId] || [];

                    container.empty();
                    $.each(assignedIndices, function (i, groupIndex) {
                        var color = groupColorsArray[groupIndex];
                        container.append('<span class="group-dot group-dot-' + groupIndex + '" data-index="' + groupIndex + '" style="display:inline-block; width:8px; height:8px; border-radius:50%; background-color:#' + color + '; margin-right:2px;"></span>');
                    });

                    {# Update checkboxes #}
                    $('.volunteer-group-checkbox[data-volunteer-id="' + volunteerId + '"]').each(function () {
                        var checkbox = $(this);
                        var index = checkbox.data('index');
                        checkbox.prop('checked', $.inArray(index, assignedIndices) !== -1);
                    });

                    row.data('groups', assignedIndices.join(','));
                });
            });
        }

        if (data['notes'] && $('#campaign-notes').data('notes-updated-timestamp') != data['notes']['notes-updated-timestamp']) {

            {# Replace note contents #}
            if (data['notes']['content'] && data['notes']['content'].length > 0) {
                $('#campaign-notes-content').html(data['notes']['content']);
            } else {
                $('#campaign-notes-content').html('{{ 'campaign_status.no_notes_yet'|trans|e('js') }}');
            }

            {# Replace last update date #}
            $('#campaign-notes-last-update').html(
                '{{ 'campaign_status.notes_updated_at'|trans|e('js') }}'
                    .replace('%date%', data['notes']['notes-updated-date'])
                    .replace('%time%', data['notes']['notes-updated-time'])
            );

            $('#campaign-notes').data('notes-updated-timestamp', data['notes']['notes-updated-timestamp']);

            refreshTextToHypertext();

            {# Applying visual effects to notice the note updates #}
            $('#campaign-notes-border').css('border', '5px solid red');
            $('#campaign-notes-last-update').css('color', 'red');
            $('#campaign-notes-ack').removeClass('d-none');
        }

        $.each(data['communications'], function (communicationId, communication) {
            var hasInvalidAnswers = 0;
            var hasNoAnswers = 0;
            $.each(communication.msg, function (messageId, messageStatus) {
                var suffix = communicationId + '-' + messageId;
                var row = $('#row-' + suffix);

                {# Message is sent #}
                if (messageStatus.sent) {
                    $('#volunteer-container-' + suffix).removeClass('text-black-50');
                }

                {# Message is "<value>" #}
                $.each(messageStatus.choices, function (choiceId, isChoice) {
                    if (isChoice) {
                        $('#message-is-choice-' + choiceId + '-' + suffix).removeClass('d-none');
                        $('#message-is-choice-time-' + choiceId + '-' + suffix).html(isChoice);
                    } else {
                        $('#message-is-choice-' + choiceId + '-' + suffix).addClass('d-none');
                    }

                    $('#message-is-choice-' + choiceId + '-' + suffix).data('value', isChoice ? 1 : 0);
                });

                {# Message has ambiguous answer #}
                if (messageStatus['has-unclear-answer']['raw']) {
                    if ('{{ constant('App\\Entity\\Communication::TYPE_SMS') }}' == communication.type) {
                        $('#answer-link-' + suffix).removeClass('d-none');
                    }
                    $('#message-is-unclear-' + suffix).removeClass('d-none');
                    $('#invalid-answer-raw-' + suffix).html(messageStatus['has-unclear-answer']['raw']).removeClass('d-none');
                } else {
                    $('#message-is-unclear-' + suffix).addClass('d-none');
                }

                {# Message has a new answer #}
                if (messageStatus['has-answer'] !== row.data('has-answer')) {
                    row.prependTo($('#top-' + communicationId));
                    row.data('has-answer', messageStatus['has-answer']);
                }

                {# an error occured while sending message #}
                if (messageStatus['error']) {
                    $('#error-' + suffix).html(messageStatus['error']).removeClass('d-none');
                }

                {# Message has invalid answer #}
                if (messageStatus['has-invalid-answer']['raw']) {
                    if ('{{ constant('App\\Entity\\Communication::TYPE_SMS') }}' == communication.type) {
                        $('#answer-link-' + suffix).removeClass('d-none');
                    }
                    $('#message-has-invalid-answer-' + suffix).removeClass('d-none');
                    $('#message-has-invalid-answer-time-' + suffix).html(messageStatus['has-invalid-answer']['time']);
                    $('#invalid-answer-raw-' + suffix).html(messageStatus['has-invalid-answer']['raw']).removeClass('d-none');
                    hasInvalidAnswers++;
                } else if (0 === messageStatus['has-answer']) {
                    hasNoAnswers++;
                } else {
                    if (!messageStatus['has-unclear-answer']['raw']) {
                        $('#message-has-invalid-answer-' + suffix).addClass('d-none');
                        $('#invalid-answer-raw-' + suffix).addClass('d-none');
                    }
                }
                $('#message-has-invalid-answer-' + suffix).data('value', messageStatus['has-invalid-answer']['raw'] ? 1 : 0);

                {# Hide "Answer" link when there are no rendered responses #}
                if (!messageStatus['has-invalid-answer']['raw'] && !messageStatus['has-unclear-answer']['raw']) {
                    $('#answer-link-' + suffix).addClass('d-none');
                }

                {# Show "refresh" on opened answer modal if new message received #}
                var refreshAnswer = $('#refresh-answers-' + messageId);
                if (refreshAnswer.length && messageStatus['has-answer'] !== refreshAnswer.data('count')) {
                    refreshAnswer.removeClass('d-none');
                }
            });

            {# Refresh the SMS sending progress bar #}
            var progressBar = $('#progress-bar-' + communicationId);
            if (communication.progress.sent >= communication.progress.reachable && !progressBar.hasClass('bg-success')) {
                progressBar.addClass('bg-success');
            }
            progressBar.attr('aria-valuenow', communication.progress.percent);
            progressBar.css('width', communication.progress.percent + '%');

            if (communication.progress.sent >= communication.progress.reachable) {
                $('#progress-text-' + communicationId).html(
                    '{{ 'campaign_status.finish'|trans|e('js') }}'
                        .replace('%sent%', communication.progress.sent)
                        .replace('%replies%', communication.progress.replies)
                        .replace('%replies_pct%', communication.progress['replies-percent'])
                        .replace('%type%', types[communication.progress.type])
                );
            } else {
                $('#progress-text-' + communicationId).html(
                    $('#progress-trans-key-' + communicationId).html()
                        .replace('%sent%', communication.progress.sent)
                        .replace('%total%', communication.progress.total)
                        .replace('%progress%', communication.progress.percent)
                        .replace('%cost%', communication.progress.cost)
                        .replace('%type%', types[communication.progress.type])
                );
            }

            $.each(communication.choices, function (choiceId, count) {
                var choice = $('#choice-count-' + choiceId);
                if (count !== choice.data('count')) {
                    choice.html(count);
                    choice.animate({fontSize: '50px'}, 500).animate({fontSize: '1rem'}, 500);
                    choice.data('count', count);
                }
            });

            var invalid = $('#has-invalid-answer-' + communicationId);
            if (hasInvalidAnswers !== invalid.data('count')) {
                invalid.html(hasInvalidAnswers);
                invalid.animate({fontSize: '50px'}, 500).animate({fontSize: '1rem'}, 500);
                invalid.data('count', hasInvalidAnswers);
            }

            var noAnswers = $('#has-no-answers-' + communicationId);
            if (hasNoAnswers !== noAnswers.data('count')) {
                noAnswers.html(hasNoAnswers);
                noAnswers.data('count', hasNoAnswers);
            }
        });

        refreshVisibility();
    }

    if ('{{ app.environment == 'dev' }}' !== '1') {
        var errorCount = 0;
        var hash = '{{ hash }}';
        var longPolling = function () {
            setTimeout(function () {
                $.ajax('{{ path('communication_long_polling', {id: campaign.id}) }}', {
                    type: 'POST',
                    data: {
                        hash: hash,
                    },
                    success: function (result) {
                        errorCount = 0;
                        if (result) {
                            hash = result.hash;
                            refreshStatuses(result);
                        }
                        longPolling();
                    },
                    error: function () {
                        errorCount++;
                        if (100 === errorCount) {
                            window.location = '{{ path('home') }}';
                        } else {
                            longPolling();
                        }
                    }
                });
            }, 1000);
        };
        longPolling();
    } else {
        setInterval(function () {
            $.ajax('{{ path('communication_short_polling', {id: campaign.id}) }}', {
                type: 'POST',
                statusCode: {
                    200: refreshStatuses,
                    401: function () {
                        document.location = '{{ path('home') }}';
                    },
                }
            });
        }, 5000);
    }

    var groupColorsArray = [];
    {% for colorName, colorCode in groupColors %}
    groupColorsArray.push("{{ colorCode|e('js') }}");
    {% endfor %}

    var activeGroupFilter = null;

    var communicationIds = [];
    {% for communication in campaign.communications %}
    communicationIds.push("{{ communication.id|e('js') }}");
    {% endfor %}

    {# -------------------------------------------------------------------------------- #}
    {# Filter rows according to ticked columns #}
    {# -------------------------------------------------------------------------------- #}

    function refreshVisibility() {

        var structures = [];
        {% for structure in campaignStructures %}
        structures.push("structure-{{ structure.id|e('js') }}");
        {% endfor %}

        var actions = [];
        {% for communication in campaign.communications %}
        actions["{{ communication.id|e('js') }}"] = [
            {% if communication.choices|length %}
            {% for choice in communication.choices %}
            "is-choice-{{ choice.id|e('js') }}",
            {% endfor %}
            {% endif %}
            "has-invalid-answer",
            "has-no-answers",
        ];
        {% endfor %}

        var skills = [];
        {% for skill in skills %}
        skills.push("is-skill-{{ skill.id|e('js') }}");
        {% endfor %}

        {#
        # Controlling each checkboxes:
        #
        # Each filter is inclusive on its category (if you select "Yes" and "No" in the response category,
        # you will get all volunteers who answered "Yes" --or-- "No").
        #
        # But, filter categories are exclusive each other (if you select "Yes" in the response category
        # and "Driver" in the skills category, you will get all volunteers that are drivers --and-- who
        # answered "Yes")
        #}

        var activeGroup = activeGroupFilter;

        $.each(communicationIds, function (key, communicationId) {
            {# counting number of filters ticked #}
            var structure = 0;
            $('.filter-structure-' + communicationId).each(function () {
                structure += $(this).is(':checked');
            });

            var response = 0;
            $('.filter-response-' + communicationId).each(function () {
                var that = $(this);
                var checked = that.is(':checked');
                response += checked;

                // Response links
                if (checked) {
                    $('#choice-' + that.data('choice-id') + ' a').css('color', 'red');
                } else {
                    $('#choice-' + that.data('choice-id') + ' a').css('color', '');
                }
            });

            if ($('#filter-has-invalid-answer-' + communicationId).is(':checked')) {
                $('#has-invalid-answer-' + communicationId).css('color', 'red');
            } else {
                $('#has-invalid-answer-' + communicationId).css('color', '');
            }

            if ($('#filter-has-no-answers-' + communicationId).is(':checked')) {
                $('#has-no-answers-' + communicationId).css('color', 'red');
            } else {
                $('#has-no-answers-' + communicationId).css('color', '');
            }

            var skill = 0;
            $('.filter-skill-' + communicationId).each(function () {
                skill += $(this).is(':checked');
            });

            var unreachable = $('#link-filter-unreachable-' + communicationId).data('value');

            {# change links color to understand which filters are enabled #}
            if (structure) {
                $('#link-filter-structure-' + communicationId).css('color', 'red');
            } else {
                $('#link-filter-structure-' + communicationId).css('color', '');
            }
            if (response) {
                $('#link-filter-response-' + communicationId).css('color', 'red');
            } else {
                $('#link-filter-response-' + communicationId).css('color', '');
            }
            if (skill) {
                $('#link-filter-skill-' + communicationId).css('color', 'red');
            } else {
                $('#link-filter-skill-' + communicationId).css('color', '');
            }
            if (unreachable) {
                $('#link-filter-unreachable-' + communicationId).css('color', 'red');
            } else {
                $('#link-filter-unreachable-' + communicationId).css('color', '');
            }
            if (activeGroup !== null) {
                $('#link-filter-group-' + communicationId).css('color', 'red');
            } else {
                $('#link-filter-group-' + communicationId).css('color', '');
            }

            {# if no filter used, everything is visible #}
            if (activeGroup === null && structure + response + skill + unreachable === 0) {
                $('.row-' + communicationId).fadeIn();
                return true;
            }

            {# if some checkbox ticked, visible if at least one value is 1 #}
            $('.row-' + communicationId).each(function () {
                var row = $(this);

                {# is visible if in the active group #}
                var groupVisible = true;
                if (activeGroup !== null) {
                    var groups = row.data('groups') ? row.data('groups').toString().split(',') : [];
                    groupVisible = $.inArray(activeGroup.toString(), groups) !== -1;
                }

                {# is visible if structure ticked and volunteer in structure #}
                var structureVisible = false;
                var structureCount = 0;
                $.each(structures, function (index, action) {
                    var suffix = action + '-' + communicationId;
                    var filter = $('#filter-' + suffix);
                    if (filter.is(':checked') && !$.inArray(filter.val(), row.data('structures').toString().split(','))) {
                        structureVisible = true;
                    }

                    structureCount += filter.is(':checked');
                });
                if (structureCount === 0) {
                    structureVisible = true;
                }

                {# is visible if answer ticked and volunteer answered OR if no answer selected #}
                var actionVisible = false;
                var actionCount = 0;
                $.each(actions[communicationId], function (key, action) {
                    var suffix = action + '-' + communicationId;
                    if ($('#filter-' + suffix).is(':checked') && row.find('.message-' + suffix).data('value') === 1) {
                        actionVisible = true;
                    }
                    actionCount += $('#filter-' + suffix).is(':checked');
                });
                if (actionCount === 0) {
                    actionVisible = true;
                }

                {# is visible if skill ticked and volunteer has it OR if no skills selected #}
                var skillVisible = false;
                var skillCount = 0;
                $.each(skills, function (key, action) {
                    var suffix = action + '-' + communicationId;
                    if ($('#filter-' + suffix).is(':checked') && row.find('.message-' + suffix).data('value') === 1) {
                        skillVisible = true;
                    }
                    skillCount += $('#filter-' + suffix).is(':checked');
                });
                if (skillCount === 0) {
                    skillVisible = true;
                }

                {# is visible if unreachable filter disabled or volunteer is reachable #}
                var unreachableVisible = true;
                if ($('#link-filter-unreachable-' + communicationId).data('value')) {
                    unreachableVisible = !row.data('is-reachable');
                }

                {# displays the row only if all conditions above are true #}
                if (groupVisible && structureVisible && actionVisible && skillVisible && unreachableVisible) {
                    row.fadeIn();
                } else {
                    row.fadeOut();
                    row.find('.volunteer-selection').prop('checked', false);
                }
            });
        });
    }

    $('.filter-action').click(function () {
        refreshVisibility();
    });
    refreshVisibility();

    $('.filter-unreachable').click(function (e) {
        e.preventDefault();
        var that = $(this);
        that.data('value', 1 - that.data('value'));
        refreshVisibility();
    });

    {# -------------------------------------------------------------------------------- #}
    {# Volunteer selection #}
    {# -------------------------------------------------------------------------------- #}

    $('.select-all').click(function () {
        var communicationId = $(this).data("communication-id");

        $('.row-' + communicationId + ':hidden')
            .find('.volunteer-selection')
            .prop('checked', false);

        $('.row-' + communicationId + ':visible').each(function () {
            var selection = $(this).find('.volunteer-selection');
            if (selection.is(':checked')) {
                selection.prop('checked', false);
            } else {
                selection.prop('checked', true);
            }
        });

        $(this).prop('checked', false);
    });
    $('.select-all, .volunteer-selection').prop('checked', false);

    function getSelectedVolunteers(communicationId) {
        var volunteerIds = [];
        $('.row-' + communicationId + ':visible').each(function () {
            var row = $(this);
            var selection = row.find('.volunteer-selection');
            if (selection.is(':checked')) {
                volunteerIds.push(row.data('volunteer-id'));
            }
        });
        if (!volunteerIds.length) {
            $('.row-' + communicationId + ':visible').each(function () {
                volunteerIds.push($(this).data('volunteer-id'));
            });
        }
        return volunteerIds;
    }

    {# -------------------------------------------------------------------------------- #}
    {# Answers viewing #}
    {# -------------------------------------------------------------------------------- #}
    $('body').on('click', '.open-message', function () {
        $('#modal-edit-answer').html('');
        $('#edit-answer').modal();
        loadCommunicationAnswers($(this));
    });

    function loadCommunicationAnswers(elem) {
        $.get({
            url: '{{ path('communication_answers') }}',
            data: {
                messageId: elem.data('message-id'),
            },
            success: function (data) {
                $('#modal-edit-answer').html(data);
            }
        });
    }

    {# -------------------------------------------------------------------------------- #}
    {# Answers edition #}
    {# -------------------------------------------------------------------------------- #}
    $('body').on('change', '.answer-change', function () {
        var that = $(this);
        var endpoint = that.data('endpoint');
        var choiceId = that.data('choice-id');

        if (!that.data('multi')) {
            $('.answer-change').not(that).prop('checked', false);
        }

        $.post(endpoint, {
            choiceId: choiceId,
        }, function () {
            loadCommunicationAnswers(that);
        });
    });

    {# -------------------------------------------------------------------------------- #}
    {# Create new communication #}
    {# -------------------------------------------------------------------------------- #}
    $('.new-message-button').click(function (e) {
        e.preventDefault();
        var communicationId = $(this).data('communication-id');
        var type = $(this).data('type');
        $('#selection-new-message-field-' + communicationId + '-' + type).val(
            JSON.stringify(getSelectedVolunteers(communicationId))
        );
        $('#selection-new-message-form-' + communicationId + '-' + type).submit();
    });

    {# -------------------------------------------------------------------------------- #}
    {# Download selection #}
    {# -------------------------------------------------------------------------------- #}
    $('.download-csv-button').click(function (e) {
        e.preventDefault();
        var communicationId = $(this).data('communication-id');
        $('#selection-download-csv-field-' + communicationId).val(
            JSON.stringify(getSelectedVolunteers(communicationId))
        );
        $('#selection-download-csv-form-' + communicationId).submit();
    });

    $('.download-pdf-button').click(function (e) {
        e.preventDefault();
        var communicationId = $(this).data('communication-id');
        $('#selection-download-pdf-field-' + communicationId).val(
            JSON.stringify(getSelectedVolunteers(communicationId))
        );
        $('#selection-download-pdf-form-' + communicationId).submit();
    });

    {# -------------------------------------------------------------------------------- #}
    {# Filter responses using the table #}
    {# -------------------------------------------------------------------------------- #}
    $('.filter-response').click(function (e) {
        var that = $(this);

        var currentlyTicked = $('#' + that.data('target')).is(':checked');

        {# Untick all responses filters #}
        $('.filter-response-' + that.data('communication-id')).each(function () {
            var tick = $(this);
            if (tick.is(':checked')) {
                tick.click();
            }
        });

        {# Tick the corresponding response #}
        if (!currentlyTicked) {
            $('#' + that.data('target')).click();
        }

        e.preventDefault();
    });

    {# -------------------------------------------------------------------------------- #}
    {# Toggle the message if it is large #}
    {# -------------------------------------------------------------------------------- #}
    $('.show-complete-body').click(function (e) {
        e.preventDefault();
        var that = $(this);
        var communicationId = that.data('communication-id');
        $('#complete-body-' + communicationId).removeClass('d-none');
        $('#limited-body-' + communicationId).addClass('d-none');
    });

    $('.show-limited-body').click(function (e) {
        e.preventDefault();
        var that = $(this);
        var communicationId = that.data('communication-id');
        $('#complete-body-' + communicationId).addClass('d-none');
        $('#limited-body-' + communicationId).removeClass('d-none');
    });

    {# -------------------------------------------------------------------------------- #}
    {# Debugging #}
    {# -------------------------------------------------------------------------------- #}
    $('.debug').click(function () {
        $('#' + $(this).data('target')).toggleClass('d-none');
    });

    {# -------------------------------------------------------------------------------- #}
    {# Transform text links into clickable links #}
    {# -------------------------------------------------------------------------------- #}
    function refreshTextToHypertext() {
        $('.text-to-hypertext').each(function () {
            var str = $(this).html();
            var regex = /(https?:\/\/([^\s]+))/ig
            var replaced_text = str.replace(regex, "<a href='$1' target='_blank'>$1</a>");
            $(this).html(replaced_text);
        });
    }

    refreshTextToHypertext();

    {# -------------------------------------------------------------------------------- #}
    {# Acknowledge notes updates #}
    {# -------------------------------------------------------------------------------- #}
    $('#campaign-notes-ack').click(function (e) {
        e.preventDefault();
        $('#campaign-notes-ack').addClass('d-none');
        $('#campaign-notes-border').css('border', '1px solid black');
        $('#campaign-notes-last-update').css('color', '');
    });

    {# -------------------------------------------------------------------------------- #}
    {# Extend event expiration date #}
    {# -------------------------------------------------------------------------------- #}
    $('#closed-at').click(function (e) {
        e.preventDefault();
        $.post('{{ path('keep_campaign', {id: campaign.id, csrf: csrf_token('campaign')}) }}', function (result) {
            $('#closed-at').html(result.expiresAt);
        });
    });

    {# -------------------------------------------------------------------------------- #}
    {# Hash and tabs #}
    {# -------------------------------------------------------------------------------- #}
    $(function () {
        var hash = window.location.hash;

        if (hash) {
            // Find the tab link whose href matches the hash
            var $tabLink = $('a[href="' + hash + '"][data-toggle="tab"]');

            if ($tabLink.length) {
                $tabLink.tab('show');
            }
        }

        // Keep URL hash in sync when user clicks different tabs
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var newHash = $(e.target).attr('href');
            if (history.replaceState) {
                history.replaceState(null, null, newHash);
            } else {
                // Fallback for dinosaurs
                window.location.hash = newHash;
            }
        });
    });

    {# -------------------------------------------------------------------------------- #}
    {# Group management #}
    {# -------------------------------------------------------------------------------- #}

    $('.group-name-input').on('change', function () {
        var that = $(this);
        var index = that.data('index');
        var name = that.val();

        $.post('{{ path('campaign_group_rename', {id: campaign.id, index: 'INDEX', csrf: csrf_token('campaign')}) }}'.replace('INDEX', index), {
            name: name
        });
    });

    $('.filter-group').click(function () {
        var that = $(this);
        var index = that.data('index');

        if (activeGroupFilter === index) {
            activeGroupFilter = null;
            $('.group-color-square').css('border-color', '#dee2e6').css('box-shadow', 'none');
        } else {
            activeGroupFilter = index;
            $('.group-color-square').css('border-color', '#dee2e6').css('box-shadow', 'none');
            $('.group-color-square[data-index="' + index + '"]').css('border-color', 'black').css('box-shadow', '0 0 0 2px black');
        }

        refreshVisibility();
    });

    $('body').on('change', '.volunteer-group-checkbox', function () {
        var checkbox = $(this);
        var volunteerId = checkbox.data('volunteer-id');
        var index = checkbox.data('index');

        $.post('{{ path('campaign_group_toggle', {id: campaign.id, volunteerId: 'VOLUNTEER_ID', index: 'INDEX', csrf: csrf_token('campaign')}) }}'
            .replace('VOLUNTEER_ID', volunteerId)
            .replace('INDEX', index), function () {
            {# We don't need to do much here, polling will update the dots if needed,
               but for better UX we could toggle them immediately. #}
        });
    });

</script>

{# -------------------------------------------------------------------------------- #}
{# Render provider details #}
{# -------------------------------------------------------------------------------- #}
{% if is_granted('ROLE_ADMIN') %}

    <script type="text/javascript">
        $('body').on('click', '.provider-modal', function (e) {
            e.preventDefault();
            $('#provider-modal-title').html('');
            $('#provider-modal-body').html('<img src="{{ asset('spinner.gif') }}"/>');
            $('#provider-modal').modal();
            $.post($(this).data('href'), function (data) {
                $('#provider-modal-title').html(data.title);
                $('#provider-modal-body').html(data.body);
            });
        });
    </script>

{% endif %}
